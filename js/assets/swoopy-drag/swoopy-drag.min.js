(function(e,c){"object"===typeof exports&&"undefined"!==typeof module?c(exports,require("d3")):"function"===typeof define&&define.amd?define(["exports","d3"],c):c(e.d3=e.d3||{},e.d3)})(this,function(e,c){e.swoopyDrag=function(){function e(a){var d=a[0].pos,m=a[2].pos;a=a[1].pos;var c=n(m,a),b=n(a,d),e=n(d,m),f=Math.acos((c*c+b*b-e*e)/(2*c*b)),c=Math.round(c*b*e/4/(.5*c*b*Math.sin(f))*1E3)/1E3;return["M",d,"A",c,c,0,+(Math.PI/2>f),+(0>(m[0]-d[0])*(a[1]-d[1])-(m[1]-d[1])*(a[0]-d[0])),m].join(" ")}function n(a,d){return Math.sqrt(Math.pow(a[0]-d[0],2)+Math.pow(a[1]-d[1],2))}function g(a,d){a.attr("transform",function(a){return"translate("+("function"==typeof d?d(a):d)+")"})}function h(a){return function(d){return d[a]}}var q=function(a){return a},r=function(a){return a},t=[],k,u=!1,f=c.dispatch("drag"),v=c.drag().on("drag",function(a){a.textOffset=[c.event.x,c.event.y].map(Math.round);c.select(this).call(g,a.textOffset);f.call("drag")}).subject(function(a){return{x:a.textOffset[0],y:a.textOffset[1]}}),w=c.drag().on("drag",function(a){a.pos=[c.event.x,c.event.y].map(Math.round);var d=c.select(this.parentNode),b="",p=d.selectAll("circle").data();"A"==p[0].type?b=e(p):p.forEach(function(a){b=b+a.type+a.pos});d.select("path").attr("d",b).datum().path=b;c.select(this).call(g,a.pos);f.call("drag")}).subject(function(a){return{x:a.pos[0],y:a.pos[1]}}),b=function(a){k=a.html("").selectAll("g").data(t).enter().append("g").call(g,function(a){return[q(a),r(a)]});a=k.append("text").call(g,h("textOffset")).text(h("text"));k.append("path").attr("d",h("path"));u&&(k.style("cursor","pointer"),a.call(v),k.selectAll("circle").data(function(a){var b=[];if(~a.path.indexOf("A"))var d=c.select(this).select("path").node(),e=d.getTotalLength(),b=[0,.5,1].map(function(a){a=d.getPointAtLength(a*e);return{pos:[a.x,a.y],type:"A"}});else{for(var f=1,g="M",k=0,l=1;l<a.path.length;l++){var h=a.path[l];","==h&&k++;if("L"==h||"C"==h||2==k)b.push({pos:a.path.slice(f,l).split(","),type:g}),g=h,f=l+1,k=0}b.push({pos:a.path.slice(f,l).split(","),type:g})}return b}).enter().append("circle").attr("r",8).attr("fill","rgba(0,0,0,0)").attr("stroke","#333").attr("stroke-dasharray","2 2").call(g,h("pos")).call(w),f.call("drag"))};b.annotations=function(a){if("undefined"==typeof a)return t;t=a;return b};b.x=function(a){if("undefined"==typeof a)return q;q=a;return b};b.y=function(a){if("undefined"==typeof a)return r;r=a;return b};b.draggable=function(a){if("undefined"==typeof a)return u;u=a;return b};b.on=function(){var a=f.on.apply(f,arguments);return a===f?b:a};return b};Object.defineProperty(e,"__esModule",{value:!0})});