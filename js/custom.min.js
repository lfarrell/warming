d3.queue().defer(d3.csv,"results/min_temps.csv").defer(d3.csv,"results/max_temps.csv").defer(d3.json,"js/us-states.json").await(function(c,e,f,g){function p(a,b,d){if(b.date.getDate()<=a[d].date.getDate())return 1}function t(){var a=d3.interval(function(d){if(void 0!==e[b]||b===m-1){var c=b===m-1?u-1:b;v.style("opacity",function(a){return p(e,a,c)});w.transition().text(q(e[c].date));x.transition().text(e[c].stationName+": "+e[c].value+" C")}void 0!==f[b]&&(y.style("opacity",function(a){return p(f,
    a,b)}),z.transition().text(q(f[b].date)),A.transition().text(f[b].stationName+": "+f[b].value+" C"));b>m&&a.stop();b++},2)}var k=window.innerWidth-40-50,r=d3.timeParse("%Y-%m-%d"),q=d3.timeFormat("%B %e");e.forEach(function(a){a.date=r(a.date);a.latitude=+a.latitude;a.longitude=+a.longitude});f.forEach(function(a){a.date=r(a.date);a.latitude=+a.latitude;a.longitude=+a.longitude});c=f.concat(e);var b=1,h=1,l=d3.geoAlbersUsa().scale(h).translate([0,0]),n=d3.geoPath().projection(l),d=n.bounds(g),h=.95/
    Math.max((d[1][0]-d[0][0])/k,(d[1][1]-d[0][1])/325),d=[(k-h*(d[1][0]+d[0][0]))/2-35,(325-h*(d[1][1]+d[0][1]))/2],l=d3.geoAlbersUsa().scale(h).translate(d),n=n.projection(l),h=d3.select("#map").append("svg").attr("vector-effect","non-scaling-stroke").attr("height",325).attr("width",k).append("g");g=h.selectAll("path").data(g.features);g.enter().append("path").merge(g).attr("d",n);g.exit().remove();g=600>k?1.5:2.3;c=h.selectAll("circle").data(c);c.enter().append("circle").merge(c).attr("class",function(a){return a.type}).attr("cx",
    function(a){return l([a.longitude,a.latitude])[0]}).attr("cy",function(a){return l([a.longitude,a.latitude])[1]}).attr("r",g).style("fill",function(a){return"high"===a.type?"orange":"steelblue"});(function(){var a=["steelblue","orange"],b=0;d3.select("#legend").append("svg").attr("width",k).attr("height",55).attr("class","legend").selectAll("g").data(["Record Low","Record High"]).enter().append("g").attr("width",190).each(function(c,d){var e=d3.select(this);e.append("rect").attr("x",b).attr("y",15).attr("width",
    10).attr("height",10).style("fill",function(b){return a[d]});e.append("text").attr("x",b+15).attr("y",25).attr("height",30).attr("width",50*c.length).text(c);b+=5*c.length+50})})();var m=f.length,u=e.length,w=d3.select("#date_low"),x=d3.select("#location_low"),z=d3.select("#date_high"),A=d3.select("#location_high"),v=d3.selectAll("circle.low"),y=d3.selectAll("circle.high");d3.select("#start").on("click touchstart",function(a){b=1;t()});d3.select("#end").on("click touchstart",function(a){b=m-1});c=d3.selectAll(".row");c.classed("opaque",!1);c.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)});