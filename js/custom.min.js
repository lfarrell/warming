d3.queue().defer(d3.csv,"results/min_temps.csv").defer(d3.csv,"results/max_temps.csv").defer(d3.json,"js/us-states.json").await(function(m,e,f,d){function w(){var a=d3.interval(function(g){if(void 0!==e[b]||b===p-1)g=b===p-1?x-1:b,q.push(e[g]),r(q,g),y.transition().text(u(e[g].date)),z.transition().text(e[g].stationName+": "+e[g].value+" C");void 0!==f[b]&&(t.push(f[b]),r(t,b),A.transition().text(u(f[b].date)),B.transition().text(f[b].stationName+": "+f[b].value+" C"));b>p&&a.stop();b++},2)}function r(a,b){1==b&&h.clearRect(0,0,k,325);for(var d=0,g=a.length;d<g;++d){var c=a[d];h.beginPath();h.moveTo(c.x,c.y);h.arc(c.x,c.y,C,0,2*Math.PI,!1);h.lineWidth=8;h.fillStyle="high"===c.type?"orange":"steelblue";h.fill()}}var k=window.innerWidth-40-50,v=d3.timeParse("%Y-%m-%d"),u=d3.timeFormat("%B %e"),b=1,n=1,l=d3.geoAlbersUsa().scale(n).translate([0,0]);m=d3.geoPath().projection(l);var c=m.bounds(d),n=.95/Math.max((c[1][0]-c[0][0])/k,(c[1][1]-c[0][1])/325),c=[(k-n*(c[1][0]+c[0][0]))/2-35,(325-n*(c[1][1]+c[0][1]))/2],l=d3.geoAlbersUsa().scale(n).translate(c);m=m.projection(l);d=d3.select("#map").append("svg").attr("class","overlay").attr("vector-effect","non-scaling-stroke").attr("height",400).attr("width",k).append("g").selectAll("path").data(d.features);d.enter().append("path").merge(d).attr("d",m);d.exit().remove();e.forEach(function(a){a.date=v(a.date);a.latitude=+a.latitude;a.longitude=+a.longitude;a.x=l([a.longitude,a.latitude])[0];a.y=l([a.longitude,a.latitude])[1]});f.forEach(function(a){a.date=v(a.date);a.latitude=+a.latitude;a.longitude=+a.longitude;a.x=l([a.longitude,a.latitude])[0];a.y=l([a.longitude,a.latitude])[1]});var D=f.concat(e);d=d3.select("#map").append("canvas").attr("class","overlay").attr("width",k).attr("height",325);var C=600>k?1.5:2,h=d.node().getContext("2d");(function(){var a=["steelblue","orange"],b=0;d3.select("#legend").append("svg").attr("width",k).attr("height",55).attr("class","legend").selectAll("g").data(["Record Low","Record High"]).enter().append("g").attr("width",
    190).each(function(c,d){var e=d3.select(this);e.append("rect").attr("x",b).attr("y",15).attr("width",10).attr("height",10).style("fill",function(b){return a[d]});e.append("text").attr("x",b+15).attr("y",25).attr("height",30).attr("width",50*c.length).text(c);b+=5*c.length+50})})();var p=f.length,x=e.length,y=d3.select("#date_low"),z=d3.select("#location_low"),A=d3.select("#date_high"),B=d3.select("#location_high"),q=[],t=[];d3.select("#start").on("click touchstart",function(a){b=1;q=[];t=[];w()});
    d3.select("#end").on("click touchstart",function(a){b=p-1;r(D,0)});d=d3.selectAll(".row");d.classed("opaque",!1);d.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)});